<!DOCTYPE html>
<html lang="es" style="background:#000000;">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Triggui â€” Cuando el impulso llega, el libro ya te espera</title>

<link rel="preconnect" href="https://www.enviaflores.com" crossorigin>
<link rel="preconnect" href="https://www.buscalibre.com.mx" crossorigin>
<link rel="dns-prefetch" href="https://www.enviaflores.com">

<style id="base-styles">
Â  html, body {Â 
Â  Â  background:#000000 !important;Â 
Â  Â  color:#fff;Â 
Â  Â  margin:0;Â 
Â  Â  padding:0;Â 
Â  Â  height:100%;Â 
Â  Â  font-family:'Archivo',sans-serif;Â 
Â  Â  -webkit-overflow-scrolling:touch;Â 
Â  Â  -webkit-text-size-adjust: 100%;Â 
Â  Â  text-size-adjust: 100%;Â 
Â  Â  overflow: hidden;
Â  Â  -webkit-font-smoothing: antialiased;
Â  Â  -moz-osx-font-smoothing: grayscale;
Â  Â  touch-action: manipulation; /* FIX: Elimina el retraso de 300ms al tocar */
Â  }
Â Â 
Â  /* Fondo animado OPTIMIZADO "Deep Space" - Colores de triggui.com */
Â  body::before {Â 
Â  Â  content:"";Â 
Â  Â  position:fixed;Â 
Â  Â  inset:0;Â 
Â  Â  background:
Â  Â  Â  radial-gradient(ellipse at 30% 20%, rgba(255, 0, 85, 0.18), transparent 65%),
Â  Â  Â  radial-gradient(ellipse at 70% 80%, rgba(255, 94, 0, 0.08), transparent 65%);
Â  Â  z-index:-1;Â 
Â  Â  pointer-events:none;
Â  Â  animation: nebula-breathe 20s ease-in-out infinite;
Â  }
Â Â 
Â  @keyframes nebula-breathe {
Â  Â  0%, 100% { opacity: 1; }
Â  Â  50% { opacity: 0.7; }
Â  }
</style>

<meta property="og:title" content="Cuando el impulso llega, el libro ya te espera">
<meta property="og:description" content="No busques libros. Deja que el conocimiento te encuentre. Directo a tu WhatsApp. 30 segundos.">
<meta property="og:image" content="https://triggui.com/imagotipo.png">
<meta property="og:url" content="https://triggui.com">
<meta property="og:type" content="website">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-CLK554FCNM"></script>
<script>
Â  window.dataLayer = window.dataLayer || [];
Â  function gtag(){dataLayer.push(arguments);}
Â  gtag('js', new Date());
Â  gtag('config', 'G-CLK554FCNM');
</script>

<script id="core-logic">
// ========================================
// ğŸ§  LOGICA DE DATOS (CORE BLINDADO)
// ========================================
function saveLocal(key, value) { try { localStorage.setItem('triggui_' + key, JSON.stringify(value)); } catch(e) {} }
function getLocal(key, defaultValue = null) { try { const data = localStorage.getItem('triggui_' + key); return data ? JSON.parse(data) : defaultValue; } catch(e) { return defaultValue; } }

function getPlatform() {
Â  const ua = navigator.userAgent || navigator.vendor || window.opera;
Â  if (/wv|WebView/i.test(ua) || (ua.includes("Android") && ua.includes("Version/"))) return "App/WebView";
Â  if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) return "iOS Web";
Â  if (/android/i.test(ua)) return "Android Web";
Â  return "Desktop";
}

window.reset = function() {
Â  localStorage.removeItem('triggui_books_opened');
Â  localStorage.removeItem('triggui_concepts');
Â  localStorage.removeItem('triggui_last_book_time');
Â  localStorage.removeItem('triggui_streak');
Â  localStorage.removeItem('triggui_last_visit');
Â  console.log('âœ… Reset completo.');
}

let tapCount = 0;
let tapTimer = null;
let cardOpenedThisSession = false;Â 

function track(event, data = {}) {
Â  if (typeof gtag !== 'undefined') gtag('event', event, { event_category: 'app_engagement', ...data });
}

function updateStreak() {
Â  const today = new Date().toDateString();
Â  const lastVisit = getLocal('last_visit');
Â  let streak = getLocal('streak', 0);

Â  if (streak === 0) {
Â  Â  streak = 1;
Â  Â  saveLocal('streak', 1);
Â  Â  saveLocal('last_visit', today);
Â  Â  return 1;
Â  }

Â  if (lastVisit === today) return streak;

Â  const yesterday = new Date(Date.now() - 86400000).toDateString();
Â  const newStreak = (lastVisit === yesterday) ? streak + 1 : 1;
Â  Â Â 
Â  saveLocal('streak', newStreak);
Â  saveLocal('last_visit', today);
Â  track('streak_updated', { streak: newStreak });
Â  return newStreak;
}

function incrementBooks() {
Â  const count = getLocal('books_opened', 0) + 1;
Â  saveLocal('books_opened', count);
Â  saveLocal('last_book_time', Date.now());
Â  track('book_opened', { total: count });
Â  return count;
}

function addConcepts(amount) {
Â  let current = getLocal('concepts', 0);
Â  const books = getLocal('books_opened', 0);
Â  if (current === 0 && books > 1) { current = books * 5; }
Â  const newVal = current + amount;
Â  saveLocal('concepts', newVal);
Â  return newVal;
}

function getRealisticUserCount() {
Â  const base = 28;
Â  const variance = Math.floor(Math.random() * 8);
Â  return base + variance;
}
</script>

<link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&family=Poppins:wght@500;600;700;800&family=Playfair+Display:ital,wght@0,500;0,700;0,800;1,500;1,700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

<style id="intro-animation">
.intro{
Â  position:fixed;Â 
Â  top:50%;Â 
Â  left:50%;Â 
Â  transform:translate(-50%,-50%);
Â  padding:2rem 2.4rem;Â 
Â  background:rgba(20,24,38,.92);Â 
Â  border-radius:28px;
Â  border: 1px solid rgba(255, 0, 85, 0.25);
Â  z-index:120;Â 
Â  font-family:'Poppins',sans-serif;Â 
Â  text-align:center;
Â  box-shadow:
Â  Â  0 20px 60px rgba(0,0,0,.5),
Â  Â  0 0 0 1px rgba(255,255,255,.08),
Â  Â  inset 0 1px 0 rgba(255,255,255,.12);
Â  backdrop-filter: blur(8px);Â 
Â  -webkit-backdrop-filter: blur(8px);
Â  font-size:clamp(1.1rem,3.8vw,1.9rem);Â 
Â  font-weight:700;Â 
Â  line-height:1.25;
Â  opacity:0;Â 
Â  transform:translate(-50%,-52%) scale(.985);
Â  animation:introIn .6s ease-out .15s forwards, introHide 3.2s 1.7s forwards;
}

.intro .t{Â 
Â  background: linear-gradient(135deg, #FF0055 0%, #FF5E00 50%, #FFD700 100%);
Â  background-size: 200% 200%;
Â  -webkit-background-clip:text;Â 
Â  -webkit-text-fill-color:transparent;
Â  animation: fire-move 4s ease infinite;
Â  text-shadow: none;
}

@keyframes introIn{ to{opacity:1; transform:translate(-50%,-50%) scale(1)} }
@keyframes introHide{ to{opacity:0; visibility:hidden; transform:translate(-50%,-80%) scale(.985)} }
</style>

<style id="grid-system">
.grid{
Â  position:absolute;
Â  inset:5vh 1.5vw;
Â  display:grid;
Â  gap:1vw;
}
@media(orientation:landscape){.grid{grid-template-columns:repeat(4,1fr)}}
@media(orientation:portrait){.grid{grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(2,1fr)}}
</style>

<style id="block-cards">
.block{
Â  position:relative;Â 
Â  display:flex;Â 
Â  align-items:center;Â 
Â  justify-content:center;
Â  padding:1rem;Â 
Â  border-radius:24px;
Â  font-weight:700;Â 
Â  cursor:pointer;
Â  background-size:320% 320%;
Â  transition: transform 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
Â  overflow:hidden;Â 
Â  isolation:isolate;
Â Â 
Â  /* BORDER NIVEL APPLE - Ultra definido */
Â  box-shadow:Â 
Â  Â  inset 0 0 0 1.5px rgba(255,255,255,.15),
Â  Â  0 4px 6px rgba(0,0,0,.15),
Â  Â  0 12px 32px rgba(0,0,0,.35);
}

/* Glassmorphism overlay PREMIUM */
.block::before{Â 
Â  content:"";
Â  position:absolute;
Â  inset:0;
Â  border-radius:inherit;Â 
Â  background: linear-gradient(
Â  Â  145deg,
Â  Â  rgba(255,255,255,.18) 0%,
Â  Â  rgba(255,255,255,.08) 40%,
Â  Â  transparent 100%
Â  );
Â  pointer-events:none;
Â  z-index: 1;
}

/* Subtle inner glow para profundidad */
.block::after {
Â  content: "";
Â  position: absolute;
Â  inset: 0;
Â  border-radius: inherit;
Â  background: radial-gradient(
Â  Â  ellipse at 50% 0%,
Â  Â  rgba(255,255,255,.12),
Â  Â  transparent 60%
Â  );
Â  pointer-events: none;
Â  opacity: 0;
Â  transition: opacity 0.3s ease;
Â  z-index: 0;
}

.block:hover::after {
Â  opacity: 1;
}

.block:hover{Â 
Â  transform: translateY(-2px) scale(1.005);
Â  box-shadow:Â 
Â  Â  inset 0 0 0 1.5px rgba(255,255,255,.22),
Â  Â  0 6px 12px rgba(0,0,0,.2),
Â  Â  0 16px 48px rgba(0,0,0,.45);
}

.block:active{Â 
Â  transform: translateY(0) scale(0.995);Â 
Â  transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1);
}

.label, .frase {Â 
Â  z-index:2;Â 
Â  text-align:center;Â 
Â  transition: opacity 0.25s ease, transform 0.25s ease;
Â  /* TIPOGRAFÃA CRYSTAL CLEAR - Sin text-shadow */
Â  text-shadow: none;
Â  -webkit-font-smoothing: antialiased;
Â  -moz-osx-font-smoothing: grayscale;
}

.label {Â 
Â  opacity:1;Â 
Â  transform:translateY(0);Â 
Â  font-size:clamp(1.05rem, 3.2vw, 1.7rem);
Â  font-weight:700;Â 
Â  line-height:1.35;Â 
Â  letter-spacing:0.2px;
}

.frase {Â 
Â  position:absolute;Â 
Â  inset:0;Â 
Â  display:flex;Â 
Â  align-items:center;Â 
Â  justify-content:center;Â 
Â  padding:1rem;Â 
Â  opacity:0;Â 
Â  transform:translateY(6px);Â 
Â  font-size:clamp(1rem, 3vw, 1.5rem);
Â  font-weight:600;
Â  line-height: 1.4;
}

.block.show .label {Â 
Â  opacity:0;Â 
Â  transform:translateY(-6px);Â 
}

.block.show .frase {Â 
Â  opacity:1;Â 
Â  transform:translateY(0);Â 
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Â  ğŸ¯ MICRO-HINT VISUAL - Solo primera visita (NIVEL DIOS ONBOARDING)
Â  Compatible iOS/Android/Web - CSS puro - Sin riesgo
Â  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes first-visit-hint {
Â  0%, 100% { transform: translateY(0) scale(1); }
Â  50% { transform: translateY(-3px) scale(1.015); }
}

.block.first-visit-hint {
Â  animation: first-visit-hint 1.8s ease-in-out 1;
Â  animation-delay: 2s;
}
</style>

<style id="portada-cover">
.portada{Â 
Â  position:absolute;Â 
Â  inset:0;Â 
Â  display:none;Â 
Â  align-items:center;Â 
Â  justify-content:center;Â 
Â  flex-direction:column;Â 
Â  padding:1rem;Â 
Â  animation:pop .6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
Â  max-height:90%;
}

@keyframes pop{Â 
Â  0%{transform:scale(.85);opacity:0}Â 
Â  100%{transform:scale(1);opacity:1}Â 
}

.portada img{Â 
Â  max-width:94%;Â 
Â  max-height:76%;Â 
Â  border-radius:20px;
Â  box-shadow:
Â  Â  0 20px 60px rgba(0,0,0,.65),
Â  Â  0 0 0 1px rgba(255,255,255,.1);
}

/* ==================== PULSE + GLOW PORTADA (Nivel Dios) ==================== */
@keyframes trigguiPulse {
Â  0% {
Â  Â  transform: scale(1);
Â  Â  filter: drop-shadow(0 0 0px rgba(255,255,255,0));
Â  }
Â  50% {
Â  Â  transform: scale(1.035);
Â  Â  filter: drop-shadow(0 0 20px rgba(255,255,255,0.15));
Â  }
Â  100% {
Â  Â  transform: scale(1);
Â  Â  filter: drop-shadow(0 0 0px rgba(255,255,255,0));
Â  }
}

.portada.reveal-pulse img {
Â  animation: trigguiPulse 2.4s cubic-bezier(0.4, 0.0, 0.2, 1) infinite;
Â  will-change: transform, filter;
}
/* ======================================================================== */

.port-text h2{Â 
Â  font-size:clamp(2rem,6vw,3.5rem);Â 
Â  font-weight:800;Â 
Â  text-shadow: none;
Â  text-align:center;
Â  -webkit-font-smoothing: antialiased;
}

.port-text p{Â 
Â  font-size:clamp(1.2rem,4vw,1.8rem);Â 
Â  font-weight:600;Â 
Â  opacity:.95;
Â  text-shadow: none;
}

.emoji-big{Â 
Â  font-size:clamp(1.6rem,5vw,2.8rem);Â 
Â  filter:drop-shadow(0 4px 12px rgba(0,0,0,.4));
}
</style>

<style id="cta-buttons">
.cta{Â 
Â  position:fixed;Â 
Â  bottom:3vh;Â 
Â  left:50%;Â 
Â  transform:translateX(-50%);Â 
Â  z-index:100;Â 
Â  display:none;Â 
Â  gap: clamp(0.5rem, 2vw, 0.9rem);Â 
Â  justify-content:center;Â 
}

.cta button{
Â  width:clamp(3.5rem,min(8vw,8vh),4.5rem);Â 
Â  height:clamp(3.5rem,min(8vw,8vh),4.5rem);
Â  border:none;Â 
Â  border-radius:50%;Â 
Â  display:flex;Â 
Â  align-items:center;Â 
Â  justify-content:center;
Â  font-size:clamp(1.5rem,3.5vw,2rem);Â 
Â  cursor:pointer;Â 
Â  background-size:200% 200%;
Â  box-shadow:Â 
Â  Â  0 0 0 1px rgba(255,255,255,.15),
Â  Â  0 6px 18px rgba(0,0,0,.35);
Â  backdrop-filter:blur(6px);
Â  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
Â  touch-action: manipulation; /* FIX: Respuesta instantÃ¡nea */
}

.cta button:hover {
Â  transform: translateY(-3px) scale(1.05);
Â  box-shadow:Â 
Â  Â  0 0 0 1px rgba(255,255,255,.25),
Â  Â  0 8px 24px rgba(0,0,0,.45);
}

.cta button:active {
Â  transform: translateY(0) scale(0.95);
Â  transition: transform 0.1s ease;
}

#otro{ background:linear-gradient(135deg,#5fbfff,#1e90ff); color:#fff; }
#fisico{ background:linear-gradient(135deg,#b2f8c8,#42d97c); color:#000; }
#share{ background:linear-gradient(135deg,#ff8a00,#ff3d3d); color:#fff; }
#like{ background:linear-gradient(135deg, #ff416c, #ff4b2b); color:#fff; }
</style>

<style id="tarjeta-overlay">
#tarjetaOverlay {Â 
Â  display:none;Â 
Â  position:fixed;Â 
Â  inset:0;Â 
Â  z-index:999;Â 
Â  align-items:center;Â 
Â  justify-content:center;Â 
Â  background: rgba(0,0,0,0.88);Â 
Â  backdrop-filter: blur(8px);Â 
Â  -webkit-backdrop-filter: blur(8px);
Â  opacity: 0;Â 
Â  transition: opacity 0.3s ease;Â 
Â  cursor: pointer;
}

#tarjetaOverlay.visible { opacity: 1; }

#tarjetaCard {Â 
Â  /* Dimensiones Inmersivas */
Â  width: 94%;Â 
Â  max-width: 500px;
Â  height: auto;Â 
Â  max-height: 85vh;
Â Â 
Â  /* Scroll Invisible */
Â  overflow-y: auto;Â 
Â  -webkit-overflow-scrolling: touch;
Â  scrollbar-width: none;
Â Â 
Â  /* Estilo FÃ­sico */
Â  border-radius: 24px;Â 
Â  position: relative;
Â  transform: scale(0.94) translateY(15px);
Â  opacity: 0;
Â  transition: transform 0.45s cubic-bezier(0.19, 1, 0.22, 1), opacity 0.4s ease;
Â Â 
Â  /* Color dinÃ¡mico */
Â  background-color: var(--paper-col);
Â  color: var(--ink-col);
Â Â 
Â  /* Sombra Profunda */
Â  box-shadow:Â 
Â  Â  0 60px 120px -30px rgba(0, 0, 0, 0.85),Â 
Â  Â  0 0 0 1px rgba(255,255,255,0.08);
Â  cursor: default;
}

#tarjetaCard::-webkit-scrollbar { display: none; }

/* Textura de papel "Grain" */
#tarjetaCard::after {
Â  content: "";Â 
Â  position: absolute;Â 
Â  inset: 0;Â 
Â  pointer-events: none;Â 
Â  z-index: 0;
Â  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");
Â  mix-blend-mode: overlay;
Â  opacity: 0.04;
Â  border-radius: 24px;
}

#tarjetaOverlay.visible #tarjetaCard {Â 
Â  transform: scale(1) translateY(0);Â 
Â  opacity: 1;Â 
}

body.webview #tarjetaCard {Â 
Â  max-height: 90vh;Â 
Â  padding-bottom: 25px;Â 
}
</style>

<style id="card-content">
/* Estructura Interna */
.card-content-wrap {
Â  position: relative;Â 
Â  z-index: 2;Â 
Â  padding: 36px 28px;
Â  display: flex;Â 
Â  flex-direction: column;Â 
Â  min-height: 100%;Â 
Â  box-sizing: border-box;
}

/* Logo Triggui Header (ARRIBA) */
.card-header-logo {
Â  display: flex;
Â  justify-content: center;
Â  margin-bottom: 24px;
}

.card-header-logo img {
Â  height: 20px;
Â  width: auto;
Â  opacity: 0.85;
}

/* TipografÃ­a */
.card-header { text-align: center; margin-bottom: 28px; }

.card-title {Â 
Â  font-family: var(--serif-font);Â 
Â  font-style: italic;Â 
Â  font-weight: 800;Â 
Â  font-size: clamp(26px, 7vw, 36px);Â 
Â  line-height: 1.05;Â 
Â  margin-bottom: 12px;Â 
Â  letter-spacing: -0.5px;
Â  -webkit-font-smoothing: antialiased;
Â  text-shadow: none;
}

.card-author {Â 
Â  font-family: var(--sans-font);Â 
Â  font-size: 11px;Â 
Â  text-transform: uppercase;Â 
Â  letter-spacing: 2.5px;Â 
Â  opacity: 0.7;Â 
Â  font-weight: 800;
Â  -webkit-font-smoothing: antialiased;
}

/* Divisor sutil para elegancia editorial */
.card-divider {Â 
Â  width: 40px;Â 
Â  height: 1px;Â 
Â  background: currentColor;Â 
Â  opacity: 0.15;Â 
Â  margin: 18px auto 0;Â 
}

.card-body {Â 
Â  font-family: var(--serif-font);Â 
Â  font-size: 19px;Â 
Â  line-height: 1.6;Â 
Â  opacity: 0.95;Â 
Â  margin-bottom: 32px;
Â  -webkit-font-smoothing: antialiased;
}

.card-highlight {Â 
Â  font-family: var(--sans-font);Â 
Â  font-weight: 700;Â 
Â  font-size: 20px;Â 
Â  margin: 26px 0;Â 
Â  line-height: 1.4;Â 
Â  color: var(--accent-col);Â 
Â  text-align: center;
Â  -webkit-font-smoothing: antialiased;
Â  text-shadow: none;
}
</style>

<style id="card-action-buttons">
.card-actions {Â 
Â  display: flex;Â 
Â  flex-direction: column;Â 
Â  gap: 16px;Â 
Â  margin-top: auto;Â 
}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Â  ğŸ¯ BLOQUE BUSCALIBRE - COMPRAR (ANCHO) + EXPLORAR (CUADRITO)
Â  Ajuste de precisiÃ³n para alineaciÃ³n perfecta con botÃ³n inferior
Â  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
.buscalibre-row {
Â  display: grid;
Â  grid-template-columns: 1fr 48px;
Â  gap: 10px;
}

/* Estilo Base BotÃ³n */
.btn-action {
Â  position: relative;Â 
Â  z-index: 10;
Â  height: 48px;
Â  border-radius: 12px;
Â  display: flex;Â 
Â  align-items: center;Â 
Â  justify-content: center;Â 
Â  gap: 8px;
Â  text-decoration: none;Â 
Â  cursor: pointer;
Â  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
Â  box-sizing: border-box;
Â  font-family: 'Archivo', sans-serif;Â 
Â  font-weight: 700;Â 
Â  font-size: 14px;Â 
Â  letter-spacing: 0.1px;
Â  touch-action: manipulation; /* FIX: Elimina tap delay */
Â  will-change: transform, opacity; /* FIX: Pre-renderiza en GPU */
}

.btn-action:active { transform: scale(0.97); }

/* FEEDBACK GLOBAL CARGANDO (NIVEL DIOS) */
.btn-action.is-opening {
  opacity: 0.7 !important;
  transform: scale(0.96) !important;
  pointer-events: none !important;
}

/* BotÃ³n Comprar - Negro con logo Buscalibre dentro */
.btn-comprar {
Â  background: #080808;
Â  color: white;
Â  border: none;
Â  box-shadow:Â 
Â  Â  0 6px 20px -6px rgba(0,0,0, 0.4),Â 
Â  Â  0 0 0 1px rgba(255,255,255, 0.08);
}

.btn-comprar:hover {
Â  box-shadow:Â 
Â  Â  0 8px 24px -6px rgba(0,0,0, 0.5),Â 
Â  Â  0 0 0 1px rgba(255,255,255, 0.12);
}

.btn-comprar img {
Â  height: 18px;
Â  width: auto;
Â  display: block;
}

/* BotÃ³n Explorar - Cuadrito con emoji */
.btn-explorar {
Â  background: rgba(125,125,125,0.06);
Â  border: 1px solid rgba(0,0,0,0.08);
Â  color: inherit;
Â  height: 48px;
Â  padding: 0;
}

.btn-explorar:active {Â 
Â  background: rgba(125,125,125,0.12);Â 
}

.card-dark-mode .btn-explorar {
Â  background: rgba(255,255,255,0.08);
Â  border: 1px solid rgba(255,255,255,0.15);
}

.card-dark-mode .btn-explorar:active {Â 
Â  background: rgba(255,255,255,0.15);Â 
}

.btn-emoji {
Â  font-size: 20px;
Â  line-height: 1;
}

/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Â  ğŸŒº BLOQUE ENVIAFLORES - LOGO DENTRO DEL BOTÃ“N (ACTIVABLE)
Â  COPIAR/PEGAR este bloque completo para activar/desactivar Enviaflores
Â  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
/* INICIO BLOQUE ENVIAFLORES */
.btn-enviaflores {
Â  width: 100%;
Â  background: #080808;
Â  color: white;
Â  border: none;
Â  box-shadow:Â 
Â  Â  0 6px 20px -6px rgba(0, 0, 0, 0.4),Â 
Â  Â  0 0 0 1px rgba(255,255,255, 0.1);
}

.btn-enviaflores:hover {
Â  box-shadow:Â 
Â  Â  0 8px 24px -6px rgba(0, 0, 0, 0.5),Â 
Â  Â  0 0 0 1px rgba(255,255,255, 0.15);
}

.btn-enviaflores img {
Â  height: 23px;
Â  width: auto;
Â  display: block;
}
/* FIN BLOQUE ENVIAFLORES */
/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */
</style>

<style id="progress-badge">
#progressBadge {
Â  position: fixed;Â 
Â  top: 15px;Â 
Â  left: 0;Â 
Â  right: 0;Â 
Â  margin: 0 auto;Â 
Â  width: fit-content;Â 
Â  max-width: 90vw;Â 
Â  z-index: 150;
Â  background: rgba(20,24,38,0.92);Â 
Â  border: 1px solid rgba(255, 0, 85, 0.2);
Â  padding: 6px 20px;Â 
Â  border-radius: 99px;Â 
Â  color: #dfe9ff;
Â  backdrop-filter: blur(10px);Â 
Â  -webkit-backdrop-filter: blur(10px);
Â  opacity: 0;Â 
Â  animation: badgeDrop 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
Â  box-shadow:Â 
Â  Â  0 6px 24px rgba(0,0,0,0.4),
Â  Â  0 0 0 1px rgba(255,255,255,0.08),
Â  Â  inset 0 1px 0 rgba(255,255,255,0.12);
Â  text-align: center;Â 
Â  cursor: pointer;Â 
Â  user-select: none;Â 
Â  pointer-events: auto;
}

@keyframes badgeDrop {Â 
Â  0% { opacity: 0; transform: translateY(-40px); }Â 
Â  100% { opacity: 1; transform: translateY(0); }Â 
}

#progressBadge .line1 {Â 
Â  display: block;Â 
Â  font-size: 10px;Â 
Â  text-transform: uppercase;Â 
Â  letter-spacing: 1.2px;Â 
Â  opacity: 0.65;Â 
Â  margin-bottom: 3px;Â 
Â  font-weight: 700;Â 
Â  color: #a0aec0;
Â  -webkit-font-smoothing: antialiased;
}

#progressBadge .line2 {Â 
Â  display: flex;Â 
Â  align-items: center;Â 
Â  justify-content: center;Â 
Â  gap: 6px;Â 
Â  flex-wrap: wrap;Â 
Â  font-size: 13px;Â 
Â  font-weight: 700;Â 
Â  color: #fff;Â 
Â  line-height: 1.2;
Â  -webkit-font-smoothing: antialiased;
}

#progressBadge .dot {Â 
Â  width: 2px;Â 
Â  height: 2px;Â 
Â  background: rgba(255,255,255,0.4);Â 
Â  border-radius: 50%;Â 
Â  display: inline-block;Â 
Â  margin: 0 2px;Â 
}

.highlight-txt {Â 
Â  background: linear-gradient(135deg, #FF0055 0%, #FF5E00 50%, #FFD700 100%);
Â  background-size: 200% 200%;
Â  -webkit-background-clip: text;
Â  -webkit-text-fill-color: transparent;
Â  animation: fire-move 4s ease infinite;
Â  text-shadow: none;
}

@keyframes fire-move {
Â  0%, 100% { background-position: 0% 50%; }
Â  50% { background-position: 100% 50%; }
}
</style>

<style id="toast-notifications">
#toast {
Â  position: fixed;Â 
Â  top: 90px;Â 
Â  left: 50%;Â 
Â  transform: translateX(-50%) translateY(-20px);Â 
Â  z-index: 160;
Â  background: rgba(20,24,38,0.95);Â 
Â  border: 1px solid rgba(255,255,255,0.12);
Â  padding: 12px 24px;Â 
Â  border-radius: 16px;Â 
Â  font-size: 15px;Â 
Â  color: #fff;
Â  backdrop-filter: blur(8px);Â 
Â  font-weight: 600;Â 
Â  opacity: 0;Â 
Â  pointer-events: none;
Â  transition: all 0.3s ease;Â 
Â  box-shadow: 0 8px 24px rgba(0,0,0,0.4);Â 
Â  text-align: center;Â 
Â  max-width: 80%;
}

#toast.visible {Â 
Â  opacity: 1;Â 
Â  transform: translateX(-50%) translateY(0);Â 
}
</style>

<style id="modal-system">
#appModal {Â 
Â  display: none;Â 
Â  position: fixed;Â 
Â  inset: 0;Â 
Â  z-index: 9999;Â 
Â  align-items: center;Â 
Â  justify-content: center;Â 
Â  background: rgba(0,0,0,0.88);Â 
Â  backdrop-filter: blur(8px);Â 
Â  opacity: 0;Â 
Â  transition: opacity 0.3s ease;Â 
}

#appModal.visible {Â 
Â  display: flex;Â 
Â  opacity: 1;Â 
}

.modal-glass {
Â  background: linear-gradient(145deg, rgba(30,34,50,0.96), rgba(10,12,20,0.98));
Â  border: 1px solid rgba(255, 0, 85, 0.25);
Â  border-radius: 28px;Â 
Â  padding: 32px;Â 
Â  width: 88%;Â 
Â  max-width: 400px;
Â  text-align: center;Â 
Â  transform: scale(0.92);
Â  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
Â  box-shadow:Â 
Â  Â  0 30px 80px rgba(0,0,0,0.8),
Â  Â  0 0 0 1px rgba(255,255,255,0.08),
Â  Â  inset 0 1px 0 rgba(255,255,255,0.15);
Â  backdrop-filter: blur(12px);
Â  -webkit-backdrop-filter: blur(12px);
}

#appModal.visible .modal-glass {Â 
Â  transform: scale(1);Â 
}

.m-emoji {Â 
Â  font-size: 52px;Â 
Â  margin-bottom: 16px;Â 
Â  display: block;Â 
Â  animation: bounce 2s ease infinite;
Â  filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3));
}

@keyframes bounce {Â 
Â  0%, 100% {transform:translateY(0);}Â 
Â  50% {transform:translateY(-12px);}Â 
}

.m-title {Â 
Â  font-size: 24px;Â 
Â  font-weight: 800;Â 
Â  margin-bottom: 10px;Â 
Â  color: #fff;Â 
Â  letter-spacing: 0.2px;
Â  -webkit-font-smoothing: antialiased;
Â  text-shadow: none;
}

.m-text {Â 
Â  font-size: 16px;Â 
Â  color: #b0b5c0;Â 
Â  line-height: 1.6;Â 
Â  margin-bottom: 26px;
Â  -webkit-font-smoothing: antialiased;
}

.m-highlight {Â 
Â  background: linear-gradient(135deg, #FF0055 0%, #FF5E00 50%, #FFD700 100%);
Â  background-size: 200% 200%;
Â  -webkit-background-clip: text;
Â  -webkit-text-fill-color: transparent;
Â  animation: fire-move 4s ease infinite;
Â  font-weight: 700;Â 
Â  display: block;Â 
Â  margin-top: 8px;Â 
Â  font-size: 15px;
Â  text-shadow: none;
}

.m-buttons {Â 
Â  display: flex;Â 
Â  flex-direction: column;Â 
Â  gap: 12px;Â 
}

.m-btn {Â 
Â  padding: 16px;Â 
Â  border-radius: 16px;Â 
Â  font-size: 16px;Â 
Â  font-weight: 700;Â 
Â  border: none;Â 
Â  cursor: pointer;Â 
Â  transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
Â  text-decoration: none;Â 
Â  display: flex;Â 
Â  align-items: center;Â 
Â  justify-content: center;
Â  -webkit-font-smoothing: antialiased;
}

.m-btn:active { transform: scale(0.96); }

.btn-primary {Â 
Â  background: linear-gradient(135deg, #FF0055, #FF5E00, #FFD700);
Â  background-size: 200% 200%;
Â  color: white;Â 
Â  box-shadow:Â 
Â  Â  0 0 0 1px rgba(255,255,255,0.15),
Â  Â  0 6px 20px rgba(255,0,85,0.4);
Â  animation: fire-move 8s ease infinite;
}

.btn-secondary {Â 
Â  background: rgba(255,255,255,0.06);Â 
Â  color: #fff;Â 
Â  border: 1px solid rgba(255,255,255,0.15);
Â  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.btn-secondary:hover {
Â  background: rgba(255,255,255,0.1);
}
</style>

<style id="floating-hearts">
.floating-heart {
Â  position: fixed;Â 
Â  pointer-events: none;Â 
Â  z-index: 200;Â 
Â  font-size: 24px;Â 
Â  opacity: 0;
Â  animation: floatUp 1.2s ease-out forwards;
Â  filter: drop-shadow(0 2px 6px rgba(0,0,0,0.3));
}

@keyframes floatUp {
Â  0% {Â 
Â  Â  transform: translate(0, 0) scale(0.5) rotate(0deg);Â 
Â  Â  opacity: 0;Â 
Â  }
Â  20% {Â 
Â  Â  opacity: 1;Â 
Â  Â  transform: translate(var(--tx), -40px) scale(1.2) rotate(15deg);Â 
Â  }
Â  100% {Â 
Â  Â  opacity: 0;Â 
Â  Â  transform: translate(var(--tx), -150px) scale(1) rotate(30deg);Â 
Â  }
}
</style>

<style id="celebration-overlay">
.cele{Â 
Â  position:fixed;Â 
Â  inset:0;Â 
Â  background:rgba(0,0,0,.92);Â 
Â  display:none;Â 
Â  align-items:center;Â 
Â  justify-content:center;Â 
Â  z-index:110;Â 
Â  flex-direction: column;
Â  backdrop-filter: blur(6px);
}

.cele-msg{Â 
Â  font-family:'Poppins';Â 
Â  font-size:2rem;Â 
Â  text-align:center;Â 
Â  background: linear-gradient(145deg, rgba(30,34,50,0.9), rgba(10,12,20,0.95));
Â  border: 1px solid rgba(255, 0, 85, 0.3);
Â  padding:2.5rem 3.5rem;Â 
Â  border-radius:24px;
Â  box-shadow:Â 
Â  Â  0 30px 80px rgba(0,0,0,0.7),
Â  Â  0 0 0 1px rgba(255,255,255,0.08),
Â  Â  inset 0 1px 0 rgba(255,255,255,0.15);
Â  backdrop-filter: blur(12px);
Â  -webkit-font-smoothing: antialiased;
}

.num{Â 
Â  background: linear-gradient(135deg, #FF0055 0%, #FF5E00 50%, #FFD700 100%);
Â  background-size: 200% 200%;
Â  -webkit-background-clip: text;
Â  -webkit-text-fill-color: transparent;
Â  animation: fire-move 4s ease infinite;
Â  font-weight:900;Â 
Â  font-size:3.2rem;
Â  text-shadow: none;
}
</style>

<style id="responsive">
@media (max-width: 480px) {
Â  #progressBadge {Â 
Â  Â  padding: 6px 14px;Â 
Â  Â  top: 12px;Â 
Â  }
Â  #progressBadge .line2 {Â 
Â  Â  font-size: 11px;Â 
Â  Â  gap: 4px;Â 
Â  }
Â  .grid { gap: 1vw; }Â 
Â  .cele-msg {Â 
Â  Â  font-size: 1.5rem;Â 
Â  Â  padding: 1.8rem 2.2rem;Â 
Â  }
Â  .num {
Â  Â  font-size: 2.6rem;
Â  }
}
</style>

</head>
<body>

<div id="progressBadge">
Â  <span class="line1">Tu chispa acumulada</span>
Â  <span class="line2" id="badgeContent">Cargando...</span>
</div>

<div id="appModal">
Â  <div class="modal-glass">
Â  Â  <span class="m-emoji" id="mEmoji">ğŸ‘‹</span>
Â  Â  <div class="m-title" id="mTitle">TÃ­tulo</div>
Â  Â  <div class="m-text" id="mText">Texto</div>
Â  Â  <div class="m-buttons">
Â  Â  Â  <button id="mBtnPrimary" class="m-btn btn-primary">Aceptar</button>
Â  Â  Â  <button id="mBtnSecondary" class="m-btn btn-secondary">Cancelar</button>
Â  Â  </div>
Â  </div>
</div>

<div id="toast"></div>
<div class="intro" id="intro"></div>
<div class="grid" id="grid"></div>

<div class="cta" id="cta">
Â  <button id="otro"><span class="icon">ğŸ²</span></button>
Â  <button id="fisico"><span class="icon">ğŸ”Ÿ</span></button>
Â  <button id="share"><span class="icon">ğŸ“–</span></button>
Â  <button id="like"><span class="icon">ğŸ˜</span></button>
</div>

<div id="tarjetaOverlay" onclick="closeCard()"><div id="tarjetaCard" onclick="handleCardClick(event)"></div></div>

<div class="cele" id="cele"><div class="cele-msg" id="celeMsg"></div></div>

<script id="js-modal-system">
// ========================================
// SISTEMA MODAL
// ========================================
const Modal = {
Â  el: document.getElementById('appModal'),
Â  emoji: document.getElementById('mEmoji'),
Â  title: document.getElementById('mTitle'),
Â  text: document.getElementById('mText'),
Â  pBtn: document.getElementById('mBtnPrimary'),
Â  sBtn: document.getElementById('mBtnSecondary'),
Â  Â Â 
Â  show: function(config) {
Â  Â  this.emoji.innerText = config.emoji || 'âœ¨';
Â  Â  this.title.innerText = config.title || 'Triggui';
Â  Â  this.text.innerHTML = config.text || '';
Â  Â  this.pBtn.innerText = config.btnText || 'Continuar';
Â  Â  this.pBtn.onclick = null; this.sBtn.onclick = null;

Â  Â  this.pBtn.onclick = () => {
Â  Â  Â  this.close();
Â  Â  Â  if(config.onConfirm) config.onConfirm();
Â  Â  };
Â  Â Â 
Â  Â  if(config.showCancel) {
Â  Â  Â  this.sBtn.style.display = 'flex';
Â  Â  Â  this.sBtn.innerText = config.cancelText || 'Cerrar';
Â  Â  Â  this.sBtn.onclick = () => {
Â  Â  Â  Â  this.close();
Â  Â  Â  Â  if(config.onCancel) config.onCancel();
Â  Â  Â  };
Â  Â  } else {
Â  Â  Â  this.sBtn.style.display = 'none';
Â  Â  }

Â  Â  this.el.style.display = 'flex';
Â  Â  setTimeout(() => this.el.classList.add('visible'), 10);
Â  },
Â  Â Â 
Â  close: function() {
Â  Â  this.el.classList.remove('visible');
Â  Â  setTimeout(() => { this.el.style.display = 'none'; }, 300);
Â  }
};
</script>

<script id="js-app-logic">
// ========================================
// LOGICA APP
// ========================================
const grid=document.getElementById("grid"), cta=document.getElementById("cta"),
Â  Â  Â  btnOtro=document.getElementById("otro"), btnLibro=document.getElementById("fisico"), btnShare=document.getElementById("share"), btnLike=document.getElementById("like"),
Â  Â  Â  cele=document.getElementById("cele"), celeMsg=document.getElementById("celeMsg"),
Â  Â  Â  progressBadge=document.getElementById("progressBadge"), toast=document.getElementById("toast");

let libro=null, revealed=false;
const portIdx=Math.floor(Math.random()*4),
Â  Â  Â  emojis=["ğŸŒŠ","ğŸ›¡ï¸","ğŸ§ ","âœ¨","ğŸ“˜","ğŸ”®","â¤ï¸","ğŸª"];
const isURL = s => /^https?:\/\//i.test(s || "");
const ANG = [115,205,35,320];
const grad = i => `linear-gradient(${ANG[i%4]}deg,${libro.colores[i]},${libro.colores[(i+1)%4]})`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸŒº ENVIAFLORES RANDOM URL SELECTOR
// COPIAR/PEGAR este bloque completo para activar/desactivar Enviaflores
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
/* INICIO BLOQUE ENVIAFLORES - JAVASCRIPT */
const ENVIAFLORES_URLS = [
Â  "https://www.enviaflores.com/florerias-nuevo-leon/san-pedro-garza-garcia/todas-las-canastas",
Â  "https://www.enviaflores.com/florerias-nuevo-leon/san-pedro-garza-garcia/todo-cumpleanos",
Â  "https://www.enviaflores.com/florerias-nuevo-leon/san-pedro-garza-garcia/todos-los-productos",
Â  "https://www.enviaflores.com/florerias-nuevo-leon/san-pedro-garza-garcia/ver-todo",
Â  "https://www.enviaflores.com/florerias-nuevo-leon/san-pedro-garza-garcia/todo-personalizado",
Â  "https://www.enviaflores.com/florerias-nuevo-leon/san-pedro-garza-garcia/todos-los-regalos",
Â  "https://www.enviaflores.com/florerias-nuevo-leon/san-pedro-garza-garcia/mas-vendidos"
];

function getRandomEnviafloresURL() {
Â  return ENVIAFLORES_URLS[Math.floor(Math.random() * ENVIAFLORES_URLS.length)];
}
/* FIN BLOQUE ENVIAFLORES - JAVASCRIPT */

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INTRO - NARRATIVA NIVEL DIOS (CON MICRO-HINT ACCIONABLE)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const frasesIntro = [
Â  "Toca. Descubre. El libro te espera.",
Â  "Cuando el impulso llega, el libro ya te espera.",
Â  "No busques libros. Deja que te encuentren.",
Â  "Si no puedes leerlo ahora, ahÃ­ se queda esperando.",
Â  "La persistencia del impulso.",
Â  "WhatsApp es la memoria de tu intenciÃ³n.",
Â  "La chispa. El impulso.",Â 
Â  "El libro correcto. El momento exacto.",Â 
Â  "30 segundos. Ya.",Â 
Â  "Empezar es lo mÃ¡s difÃ­cil.",Â 
Â  "La fricciÃ³n desaparece.",Â 
Â  "El impulso que te activa.",Â 
Â  "Ya entraste.",Â 
Â  "La chispa que elimina la fricciÃ³n.",Â 
Â  "Elimina la fricciÃ³n de empezar.",Â 
Â  "El micro-hÃ¡bito mÃ¡s fÃ¡cil.",Â 
Â  "Una idea. 30 segundos.",Â 
Â  "Sin abrir nada mÃ¡s.",Â 
Â  "El impulso. Ahora.",Â 
Â  "La frase que te activa.",Â 
Â  "Ya empezaste.",Â 
Â  "Como ponerte los tenis.",Â 
Â  "El primer paso.",Â 
Â  "La chispa. Ya.",Â 
Â  "Elimina la fricciÃ³n.",Â 
Â  "El libro. El momento."
];
document.getElementById("intro").innerHTML=`<span class="t">${frasesIntro[Math.floor(Math.random()*frasesIntro.length)]}</span>`;

// === TRIPLE TAP RESET ===
progressBadge.addEventListener('click', () => {
Â  tapCount++;
Â  if (tapCount === 1) tapTimer = setTimeout(() => { tapCount = 0; }, 800);
Â  if (tapCount === 3) {
Â  Â  clearTimeout(tapTimer); tapCount = 0;
Â  Â  Modal.show({
Â  Â  Â  emoji: 'ğŸ”„', title: 'Â¿Reiniciar Contadores?', text: 'Esto pondrÃ¡ tus estadÃ­sticas a cero.',
Â  Â  Â  btnText: 'SÃ­, Reiniciar', showCancel: true, cancelText: 'Cancelar',
Â  Â  Â  onConfirm: () => {
Â  Â  Â  Â  window.reset();
Â  Â  Â  Â  location.reload();
Â  Â  Â  }
Â  Â  });
Â  }
});

function showToast(msg, duration=3000) {
Â  toast.textContent = msg; toast.classList.add('visible');
Â  setTimeout(() => toast.classList.remove('visible'), duration);
}

// âœ¨ UPDATE BADGE (Chispas activadas)
function updateBadge() {
Â  const streak = updateStreak();Â 
Â  const books = getLocal('books_opened', 0);
Â  const concepts = getLocal('concepts', books * 5);Â 
Â Â 
Â  const diasTexto = streak === 1 ? 'dÃ­a' : 'dÃ­as';
Â  const librosTexto = books === 1 ? 'libro' : 'libros';
Â Â 
Â  document.getElementById('badgeContent').innerHTML =Â 
Â  Â  `ğŸ”¥ ${streak} ${diasTexto} <span class="dot"></span> ğŸ“š ${books} ${librosTexto} <span class="dot"></span> <span class="highlight-txt">âš¡ ${concepts} chispas activadas</span>`;
}

// BUILDERS
function adjustScale(wrap){
Â  const parent=wrap.closest(".portada"); if(!parent)return;
Â  const avail=parent.clientHeight-40; let scale=1;
Â  wrap.style.transform="scale(1)";
Â  while(wrap.scrollHeight>avail&&scale>0.55){ scale-=.02; wrap.style.transform=`scale(${scale})`; }
}

function buildPort(i){
Â  const d=document.createElement("div"); d.className="portada";
Â  const wrap=document.createElement("div"); wrap.className="port-text-wrap";
Â  const box=document.createElement("div"); box.className="port-text";
Â  box.innerHTML=`<h2>${libro.titulo}</h2><p>${libro.autor}</p>`;
Â  const emoji=document.createElement("div"); emoji.className="emoji-big";
Â  emoji.textContent=emojis[i%emojis.length];
Â  wrap.append(box,emoji);
Â  if(isURL(libro.portada)){ d.append(Object.assign(new Image(),{src:libro.portada,loading:"lazy"})); }
Â  else{ d.append(wrap); setTimeout(()=>adjustScale(wrap),0); }
Â  d.addEventListener("click", e => { e.stopPropagation(); btnShare.click(); });
Â  return d;
}

function render(){
Â  grid.innerHTML="";
Â  for(let i=0;i<4;i++){
Â  Â  const card=document.createElement("div"); card.className="block"; card.style.background=grad(i);
Â  Â  const label=document.createElement("div"); label.className="label";
Â  Â  label.textContent=`${emojis[i%emojis.length]} ${libro.palabras[i]}`;
Â  Â  label.style.color=libro.textColors?.[i]||"#fff";
Â  Â  const frase=document.createElement("div"); frase.className="frase";
Â  Â  frase.textContent=libro.frases[i]; frase.style.color=libro.textColors?.[i]||"#fff";
Â  Â  const port=buildPort(i);

Â  Â  if(i===portIdx){
Â  Â  Â  card.append(port, label, frase);
Â  Â  Â  card.onclick = e => {
Â  Â  Â  Â  if(!revealed){
Â  Â  Â  Â  Â  label.style.display="none"; port.style.display="flex"; port.classList.add("reveal-pulse");
Â  Â  Â  Â  Â  [...grid.children].forEach((c,j)=>j!==portIdx&&c.classList.add("show"));
Â  Â  Â  Â  Â  cta.style.display="flex"; revealed=true;
Â  Â  Â  Â  Â  const c = libro.colores;
Â  Â  Â  Â  Â  document.getElementById("otro").style.background = `linear-gradient(135deg, ${c[0]}, ${c[1]})`;
Â  Â  Â  Â  Â  document.getElementById("fisico").style.background = `linear-gradient(135deg, ${c[1]}, ${c[2]})`;
Â  Â  Â  Â  Â  document.getElementById("share").style.background = `linear-gradient(135deg, ${c[2]}, ${c[3]})`;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  document.getElementById("like").style.background = `linear-gradient(135deg, #ff416c, #ff4b2b)`;

Â  Â  Â  Â  Â  document.getElementById("otro").style.color = pickTextColor(c[0]);
Â  Â  Â  Â  Â  document.getElementById("fisico").style.color = pickTextColor(c[1]);
Â  Â  Â  Â  Â  document.getElementById("share").style.color = pickTextColor(c[2]);
Â  Â  Â  Â  Â  handleBookReveal();
Â  Â  Â  Â  } else { e.stopPropagation(); btnShare.click(); }
Â  Â  Â  };
Â  Â  } else {
Â  Â  Â  card.append(label, frase);
Â  Â  Â  card.onclick = () => { if(revealed) location.reload(); else card.classList.toggle("show"); };
Â  Â  }
Â  Â  grid.append(card);
Â  }
}

// LOGICA ENGAGEMENT - NARRATIVA NIVEL DIOS
function handleBookReveal() {
Â  const booksCount = incrementBooks();
Â  addConcepts(4);Â 
Â  updateBadge();
Â  fetch("https://triggui-api.vercel.app/api/increment", {cache:"no-store"}).catch(()=>{});

Â  const delay = 1500;
Â  const userCount = getRealisticUserCount();

Â  if (booksCount === 2) {
Â  Â  setTimeout(() => Modal.show({
Â  Â  Â  emoji: 'ğŸ”¥',Â 
Â  Â  Â  title: 'Cuando el impulso llega',Â 
Â  Â  Â  text: 'El libro ya te espera en WhatsApp.<span class="m-highlight">Si no puedes leerlo ahora, ahÃ­ se queda esperando.</span>',
Â  Â  Â  btnText: 'Quiero mi chispa semanal',Â 
Â  Â  Â  onConfirm: () => window.open('https://triggui.com/#planes', '_blank'),
Â  Â  Â  showCancel: true,Â 
Â  Â  Â  cancelText: 'Seguir explorando'
Â  Â  }), delay);
Â  } else if (booksCount === 5) {
Â  Â  setTimeout(() => Modal.show({
Â  Â  Â  emoji: 'âš¡',Â 
Â  Â  Â  title: 'La persistencia del impulso',Â 
Â  Â  Â  text: 'Una idea por semana. Directo a tu WhatsApp. 30 segundos.<span class="m-highlight">$149/mes Â· Cancela cuando quieras</span>',
Â  Â  Â  btnText: 'Activar ahora',Â 
Â  Â  Â  onConfirm: () => window.open('https://triggui.com/#planes', '_blank'),
Â  Â  Â  showCancel: true
Â  Â  }), delay);
Â  } else if (booksCount === 10) {
Â  Â  setTimeout(() => Modal.show({
Â  Â  Â  emoji: 'ğŸ§ ',Â 
Â  Â  Â  title: 'No es falta de ganas',Â 
Â  Â  Â  text: `Es fricciÃ³n de empezar. ${userCount} personas lo eliminaron hoy.<span class="m-highlight">El libro te encuentra por WhatsApp</span>`,
Â  Â  Â  btnText: 'Suscribirme',Â 
Â  Â  Â  onConfirm: () => window.open('https://triggui.com/#planes', '_blank'),
Â  Â  Â  showCancel: true
Â  Â  }), delay);
Â  } else if ([15, 20, 30, 50, 75, 100].includes(booksCount)) {
Â  Â  setTimeout(() => Modal.show({
Â  Â  Â  emoji: 'ğŸ’',Â 
Â  Â  Â  title: `${booksCount} chispas activadas`,Â 
Â  Â  Â  text: 'Empezar ya no se siente pesado.<span class="m-highlight">Precio de lanzamiento hoy</span>',
Â  Â  Â  btnText: 'Ver planes',Â 
Â  Â  Â  onConfirm: () => window.open('https://triggui.com/#planes', '_blank'),
Â  Â  Â  showCancel: true
Â  Â  }), delay);
Â  }
}

// === LIKE & SHARE ===
btnLike.onclick = (e) => {
Â  const rect = btnLike.getBoundingClientRect();
Â  const centerX = rect.left + rect.width / 2;
Â  const centerY = rect.top + rect.height / 2;
Â  for (let i = 0; i < 8; i++) { createFloatingHeart(centerX, centerY); }
Â Â 
Â  const rachaActual = getLocal('streak', 0);
Â  const totalLibros = getLocal('books_opened', 0);
Â  const conceptosActuales = getLocal('concepts', 0);
Â  const tipoDispositivo = getPlatform();

Â  try {
Â  Â  const frasesVistas = libro.frases.join(" | ");
Â  Â  const urlScript = "https://script.google.com/macros/s/AKfycbyJdF6QZ4b321MUzzkpkvNLEL4-ZJDdgzs7gXTS6bhtI0HMgnJQnAm7tZMeo7u8oatE/exec";
Â  Â  fetch(urlScript, {
Â  Â  Â  method: "POST",
Â  Â  Â  headers: { "Content-Type": "application/x-www-form-urlencoded" },
Â  Â  Â  body: new URLSearchParams({
Â  Â  Â  Â  "action": "like", "book": libro.titulo, "author": libro.autor, "phrases": frasesVistas, "streak": rachaActual,
Â  Â  Â  Â  "total_books": totalLibros, "platform": tipoDispositivo, "concepts": conceptosActuales, "source": "like-button"
Â  Â  Â  })
Â  Â  });
Â  Â  track('like_clicked', { book: libro.titulo, streak: rachaActual });
Â  } catch (err) { console.log("Error enviando like:", err); }

Â  setTimeout(() => {
Â  Â  Modal.show({
Â  Â  Â  emoji: 'ğŸ“¸',Â 
Â  Â  Â  title: 'Este momento es tuyo',Â 
Â  Â  Â  text: 'GuÃ¡rdalo. CompÃ¡rtelo.<span class="m-highlight">Cuando el impulso llega, el libro ya te espera</span>',
Â  Â  Â  btnText: 'Listo',Â 
Â  Â  Â  onConfirm: () => {},Â 
Â  Â  Â  showCancel: false
Â  Â  });
Â  }, 1500);
};

function createFloatingHeart(x, y) {
Â  const heart = document.createElement('div');
Â  heart.classList.add('floating-heart');
Â  heart.innerText = ['â¤ï¸', 'ğŸ˜', 'ğŸ”¥'][Math.floor(Math.random() * 3)];
Â  document.body.appendChild(heart);
Â  const randomX = (Math.random() - 0.5) * 60;Â 
Â  heart.style.left = `${x}px`; heart.style.top = `${y}px`;
Â  heart.style.setProperty('--tx', `${randomX}px`);
Â  setTimeout(() => heart.remove(), 1200);
}

// HANDLERS
btnOtro.onclick = () => { location.reload(); track('reload_clicked'); };
btnLibro.onclick = async() => {
Â  btnLibro.disabled=true; cele.style.display="flex"; celeMsg.innerHTML='<span class="num">...</span><br>chispas activadas juntos';
Â  try{ const r=await fetch("https://triggui-api.vercel.app/api/increment"); const d=await r.json(); celeMsg.innerHTML=`âš¡ <span class="num">${d.total.toLocaleString("es-MX")}</span><br>chispas activadas juntos`; track('physical_book_opened', { total: d.total }); }catch{}
Â  setTimeout(()=>{ cele.style.display="none"; btnLibro.disabled=false; },2300);
};

function luminance(hex) { try { const c = hex.replace("#","").match(/.{1,2}/g).map(x=>parseInt(x,16)/255); const f = v => v<=.03928 ? v/12.92 : Math.pow((v+.055)/1.055,2.4); return 0.2126*f(c[0])+0.7152*f(c[1])+0.0722*f(c[2]); } catch { return 0; } }
function pickTextColor(bg) { try { return luminance(bg) > 0.35 ? "#000" : "#fff"; } catch { return "#fff"; } }

// SHARE & TARJETA
btnShare.onclick = () => {
Â  const t = libro.tarjeta;Â 
Â  const overlay = document.getElementById("tarjetaOverlay");
Â  const card = document.getElementById("tarjetaCard");
Â Â 
Â  if (!cardOpenedThisSession) {
Â  Â  addConcepts(1); updateBadge(); cardOpenedThisSession = true;
Â  }

Â  // Estilos del JSON
Â  const sPaper = t.style.paper || "#fff";Â 
Â  const sInk = t.style.ink || "#111";Â 
Â  const sAccent = t.style.accent || "#30ffe4";
Â  const sSerif = t.style.serif || "'Playfair Display', serif";
Â  const sSans = t.style.sans || "'Archivo', sans-serif";
Â  const p = libro.palabras && libro.palabras.length > 0 ? libro.palabras[Math.floor(Math.random()*libro.palabras.length)] : "";

Â  // Inyectar variables CSS
Â  card.style.setProperty('--paper-col', sPaper);
Â  card.style.setProperty('--ink-col', sInk);
Â  card.style.setProperty('--accent-col', sAccent);
Â  card.style.setProperty('--serif-font', sSerif);
Â  card.style.setProperty('--sans-font', sSans);

Â  // Modo Oscuro
Â  const isDark = pickTextColor(sPaper) === '#fff';
Â  if (isDark) { card.classList.add('card-dark-mode'); }Â 
Â  else { card.classList.remove('card-dark-mode'); }

Â  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Â  // ğŸ¯ RENDER HTML - OPTIMIZADO PARA CARGA INSTANTÃNEA (REL NOOPENER)
Â  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Â  const randomEnviafloresURL = getRandomEnviafloresURL();
Â Â 
Â  card.innerHTML = `
Â  Â  <div class="card-content-wrap">
Â  Â  Â Â 
Â  Â  Â  <div class="card-header-logo">
Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/badirnakid/triggui-app/main/public/trigguiletras2.png"Â 
Â  Â  Â  Â  Â  Â  Â alt="Triggui"
Â  Â  Â  Â  Â  Â  Â style="filter: ${isDark ? 'invert(1) brightness(1.5)' : 'none'};">
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  <div class="card-title">${libro.titulo}</div>
Â  Â  Â  Â  <div class="card-author">${libro.autor}</div>
Â  Â  Â  Â  <div class="card-divider"></div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  <div style="margin-bottom:18px;">${t.parrafoTop}</div>
Â  Â  Â  Â  <div class="card-highlight">${t.subtitulo}</div>
Â  Â  Â  Â  <div>${t.parrafoBot}</div>
Â  Â  Â  </div>

Â  Â  Â  <div class="card-actions">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="buscalibre-row">
Â  Â  Â  Â  Â  <a href="https://www.buscalibre.com.mx/libros/search/?q=${encodeURIComponent(libro.titulo + ' ' + libro.autor)}"Â 
Â  Â  Â  Â  Â  Â  Â target="_blank"Â 
Â  Â  Â  Â  Â  Â  Â rel="noopener noreferrer"
Â  Â  Â  Â  Â  Â  Â class="btn-action btn-comprar">
Â  Â  Â  Â  Â  Â  Â <img src="https://raw.githubusercontent.com/badirnakid/triggui-app/main/public/buscalibre.png"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  alt="Buscalibre">
Â  Â  Â  Â  Â  Â  Â <span>Comprar</span>
Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <a href="https://www.buscalibre.com.mx/libros/search/?q=${encodeURIComponent(p)}"Â 
Â  Â  Â  Â  Â  Â  Â target="_blank"Â 
Â  Â  Â  Â  Â  Â  Â rel="noopener noreferrer"
Â  Â  Â  Â  Â  Â  Â class="btn-action btn-explorar">
Â  Â  Â  Â  Â  Â  Â <span class="btn-emoji">âœ¨</span>
Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <a href="${randomEnviafloresURL}"Â 
Â  Â  Â  Â  Â  Â target="_blank"Â 
Â  Â  Â  Â  Â  Â rel="noopener noreferrer"
Â  Â  Â  Â  Â  Â class="btn-action btn-enviaflores">
Â  Â  Â  Â  Â  Â <img src="https://raw.githubusercontent.com/badirnakid/triggui-app/main/public/enviaflores-logo.png"Â 
Â  Â  Â  Â  Â  Â  Â  Â  alt="EnvÃ­a Flores">
Â  Â  Â  Â  Â  Â <span>Ãšnelo a un regalo</span>
Â  Â  Â  Â  </a>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  `;

Â  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Â  // ğŸ¯ SISTEMA NIVEL DIOS TODOPODEROSO (ULTRA-PRECISO)
  // Inteligencia de Foco para Redirecciones Externas
Â  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  const instantLinkFix = (btnSelector, loadingText, originalText, trackingEvent) => {
    const btn = card.querySelector(btnSelector);
    if (!btn) return;

    let isLocked = false;
    let fallbackTimer = null;

    const resetBtn = () => {
      btn.classList.remove('is-opening');
      const s = btn.querySelector('span');
      if (s) s.textContent = originalText;
      isLocked = false;
      if (fallbackTimer) clearTimeout(fallbackTimer);
    };

    btn.addEventListener('click', function(e) {
      if (isLocked) { e.preventDefault(); return; }
      isLocked = true;

      // 1. VibraciÃ³n HÃ¡ptica
      try { if(navigator.vibrate) navigator.vibrate(18); } catch(_) {}

      // 2. Feedback Visual
      this.classList.add('is-opening');
      const span = this.querySelector('span');
      if (span) span.textContent = loadingText;

      // 3. Tracking
      try { track(trackingEvent, { book: libro.titulo }); } catch(_) {}

      // 4. MONITOR DE FOCO (Evita el reset prematuro)
      // Si pasan 6 segundos y seguimos aquÃ­, liberamos (fallo o red lenta)
      fallbackTimer = setTimeout(() => {
        if (!document.hidden) resetBtn();
      }, 6000);

      // Si el usuario regresa a la pestaÃ±a o el WebView recupera el foco
      window.addEventListener('visibilitychange', () => {
        if (!document.hidden && isLocked) resetBtn();
      }, { once: true });
    });
  };

  instantLinkFix('.btn-enviaflores', 'Abriendo...', 'Ãšnelo a un regalo', 'enviaflores_clicked');
  instantLinkFix('.btn-comprar', 'Buscando...', 'Comprar', 'buscalibre_clicked');
  instantLinkFix('.btn-explorar', 'Sorpresa...', 'âœ¨', 'explorar_clicked');

Â  overlay.style.display="flex";
Â  setTimeout(() => overlay.classList.add('visible'), 10);
Â  track('card_viewed', { book: libro.titulo });
};

// LOGICA DE CIERRE (MÃXIMA PRIORIDAD)
window.handleCardClick = function(e) {
Â  if (e.target.closest('a') || e.target.closest('button')) {
Â  Â  e.stopPropagation();
Â  Â  return;
Â  }
Â  window.closeCard();
}

window.closeCard = function() {
Â  const overlay = document.getElementById("tarjetaOverlay");
Â  overlay.classList.remove('visible');
Â  setTimeout(() => { overlay.style.display="none"; }, 300);
}

// INIT
function isWebView(){ const ua=navigator.userAgent||navigator.vendor||window.opera; return (/wv/i.test(ua)||/WebView/i.test(ua)||(ua.includes("Android")&&ua.includes("Version/"))||(ua.includes("iPhone")&&!ua.includes("Safari"))); }
if(isWebView()) document.body.classList.add("webview");

function pickLibroNoRepetido(libros){
Â  let last=sessionStorage.getItem("lastLibroIdx"); if(last!==null)last=parseInt(last);
Â  let idx=Math.floor(Math.random()*libros.length);
Â  if(idx===last){ idx=Math.floor(Math.random()*libros.length); if(idx===last)idx=(idx+1)%libros.length; }
Â  sessionStorage.setItem("lastLibroIdx", idx); return idx;
}

(async()=>{
Â  try{
Â  Â  const r=await fetch("https://raw.githubusercontent.com/badirnakid/triggui-content/main/contenido.json?ts="+Date.now());
Â  Â  const data=await r.json();
Â  Â  libro=data.libros[pickLibroNoRepetido(data.libros)];
Â  Â  render();Â 
Â  Â  updateBadge();
Â  Â  track('app_loaded', {streak:getLocal('streak',0), books:getLocal('books_opened',0)});
Â  Â Â 
Â  Â  if (!getLocal('has_visited')) {
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  document.querySelectorAll('.block').forEach(b => b.classList.add('first-visit-hint'));
Â  Â  Â  Â  saveLocal('has_visited', true);
Â  Â  Â  }, 100);
Â  Â  }
Â  Â Â 
Â  }catch(e){Â 
Â  Â  console.error(e);
Â  }
})();
</script>

<script id="js-react-native-bridge">
Â  const signalFirstPaint = () => { requestAnimationFrame(() => { try { window.ReactNativeWebView?.postMessage("FIRST_PAINT"); } catch (_) {} }); };
Â  if (document.readyState === "interactive" || document.readyState === "complete") { signalFirstPaint(); } else { document.addEventListener("DOMContentLoaded", signalFirstPaint, { once: true }); }
</script>

</body>
</html>
