<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>TrigguiApp â€“ Toca un bloque</title>
  <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;700&family=Poppins:wght@500&display=swap" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%;
      height: 100%;
      font-family: 'Archivo', sans-serif;
      background: linear-gradient(135deg, #0d0e1a, #1a1c2d);
      overflow: hidden;
    }
    body.dark {
      background: #000;
    }
    #grid {
      display: grid;
      gap: 1.5vw;
      padding: 2vw;
      width: 100%;
      height: 100%;
      transition: all 0.5s ease;
    }
    .block {
      border-radius: 20px;
      color: white;
      font-weight: bold;
      font-size: 1.4rem;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      background-size: 200% 200%;
      background-position: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .block-content {
      padding: 8px;
      z-index: 2;
      position: absolute;
    }
    .accionable {
      font-family: 'Poppins', sans-serif;
      font-size: 1.1rem;
      font-weight: 600;
      opacity: 0;
      transition: opacity 0.5s ease;
      text-align: center;
    }
    .portada-wrapper {
      width: 100%;
      height: 100%;
      border-radius: 20px;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .portada-wrapper img {
      width: 85%;
      height: auto;
      max-height: 90%;
      object-fit: contain;
      border-radius: 20px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.4);
    }
    #mensajeInicial {
      position: absolute;
      top: 3%;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 1.1rem;
      font-family: 'Poppins', sans-serif;
      background: rgba(0,0,0,0.4);
      padding: 10px 20px;
      border-radius: 999px;
      z-index: 10;
      text-align: center;
      white-space: nowrap;
    }
    #shockBtn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #00c853, #b2ff59);
      color: black;
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      border: none;
      border-radius: 999px;
      padding: 14px 24px;
      font-size: 1rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      display: none;
      cursor: pointer;
      z-index: 11;
    }
    #contador {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #ffee58;
      font-size: 1.6rem;
      font-family: 'Poppins', sans-serif;
      background: rgba(0,0,0,0.6);
      padding: 20px 30px;
      border-radius: 20px;
      text-align: center;
      display: none;
      z-index: 12;
      box-shadow: 0 0 20px rgba(255,255,255,0.1);
    }
    #logoTriggui {
      position: absolute;
      bottom: 14px;
      left: 14px;
      height: 22px;
      opacity: 0.4;
    }
  </style>
</head>
<body>
  <div id="mensajeInicial">Toca el bloque donde creas que estÃ¡ el libro ðŸ“š</div>
  <div id="grid"></div>
  <button id="shockBtn">âœ… Â¡SÃ­! AbrÃ­ un libro fÃ­sico</button>
  <div id="contador"></div>
  <img id="logoTriggui" src="/trigguiletras.png" />

  <script>
    const $ = id => document.getElementById(id);
    let libroActual, bloquePortada, revelado = false;

    fetch("https://raw.githubusercontent.com/badirnakid/triggui-content/main/contenido.json")
      .then(res => res.json())
      .then(data => {
        const libro = data.libros[Math.floor(Math.random()*data.libros.length)];
        libroActual = libro;
        bloquePortada = Math.floor(Math.random()*4);
        iniciarUI(libro);
      });

    function generarGradiente(color) {
      const h = parseInt(color.slice(1,3),16),
            l = parseInt(color.slice(3,5),16),
            s = parseInt(color.slice(5,7),16);
      const light = `rgba(${Math.min(h+40,255)},${Math.min(l+40,255)},${Math.min(s+40,255)},0.9)`;
      return `linear-gradient(135deg, ${color}, ${light})`;
    }

    function ajustarLayout() {
      const grid = $("grid");
      const width = window.innerWidth;
      const height = window.innerHeight;
      const portrait = height >= width;
      grid.style.gridTemplateColumns = portrait ? "1fr 1fr" : "repeat(4, 1fr)";
      grid.style.gridTemplateRows = portrait ? "1fr 1fr" : "1fr";
      grid.style.height = "100vh";
    }

    function iniciarUI(libro) {
      ajustarLayout();
      const grid = $("grid");
      grid.innerHTML = "";
      const randomPrompt = Math.floor(Math.random() * 4);
      libro.palabras.forEach((palabra, i) => {
        const div = document.createElement("div");
        div.className = "block";
        div.id = `bloque${i}`;
        div.style.background = generarGradiente(libro.colores[i]);
        div.innerHTML = `
          <div class="block-content label">${i === randomPrompt ? "Â¿QuÃ© sientes?" : palabra}</div>
          <div class="block-content accionable" id="bloque${i}Text">${libro.frases[i]}</div>`;
        div.onclick = () => manejarClick(i);
        grid.appendChild(div);
      });
      document.querySelectorAll('.accionable').forEach(el => el.style.opacity = 0);
    }

    function manejarClick(i) {
      if (revelado) return location.reload();
      if (i === bloquePortada) revelarTodo();
      else {
        $(`bloque${i}Text`).style.opacity = 1;
        $(`bloque${i}`).querySelector(".label").style.opacity = 0;
      }
    }

    function revelarTodo() {
      document.body.classList.add("dark");
      document.getElementById("mensajeInicial").style.display = "none";
      libroActual.palabras.forEach((_, i) => {
        const block = $(`bloque${i}`);
        if (i === bloquePortada) {
          block.innerHTML = "";
          const wrapper = document.createElement("div");
          wrapper.className = "portada-wrapper";
          const img = document.createElement("img");
          img.src = libroActual.portada;
          img.alt = "Portada";
          wrapper.appendChild(img);
          block.appendChild(wrapper);
          block.style.background = "none";
        } else {
          $(`bloque${i}Text`).style.opacity = 1;
          block.querySelector(".label").style.opacity = 0;
        }
      });
      setTimeout(() => {
        $("shockBtn").style.display = "block";
      }, 2500);
      revelado = true;
    }

    $("shockBtn").onclick = async () => {
      $("shockBtn").style.display = "none";
      $("contador").style.display = "block";
      $("contador").innerText = "ðŸ“š Calculando libros abiertos...";
      try {
        const res = await fetch("https://triggui-api.vercel.app/api/increment");
        const data = await res.json();
        $("contador").innerHTML = `âœ¨ Gracias. Ya somos <strong>${data.total.toLocaleString('es-MX')}</strong> abriendo libros fÃ­sicos âœ¨`;
      } catch {
        $("contador").innerText = "ðŸ“š Â¡Error al contar libros!";
      }
    };

    window.addEventListener("resize", ajustarLayout);
  </script>
</body>
</html>
