<!DOCTYPE html>
<html lang="es" style="background:#0e0f1b;">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover, shrink-to-fit=no">
<title>Triggui ‚Äî Abre un libro f√≠sico. Aqu√≠ y ahora.</title>

<!-- CSS cr√≠tico para evitar pantalla blanca -->
<style>
  html, body {
    background:#0e0f1b !important;
    color:#fff;
    margin:0;
    padding:0;
    height:100%;
  }
</style>


<!-- OG / Twitter -->
<meta property="og:title" content="Abre. Un Libro. F√≠sico.">
<meta property="og:description" content="Toma un libro f√≠sico que tengas cerca, √°brelo en cualquier parte, lee la primera l√≠nea que veas.">
<meta property="og:image" content="https://triggui.com/imagotipo.png">
<meta property="og:url" content="https://triggui.com">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Triggui ‚Äì Abre un libro f√≠sico. Aqu√≠ y ahora.">
<meta name="twitter:description" content="Un impulso real. Nada m√°s. Nada menos.">
<meta name="twitter:image" content="https://triggui.com/imagotipo.png">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CLK554FCNM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CLK554FCNM');
</script>

<link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;700&family=Poppins:wght@500;800&display=swap" rel="stylesheet">

<style>
:root{
  /* Di√°metro de los botones: adapta de 4 rem (m√≥vil) a 7 rem (desktop grande) */
  --btnSize: clamp(4rem, 15vw, 7rem);
}

*{margin:0;padding:0;box-sizing:border-box}
html,body{
  height:100%;
  font-family:'Archivo',sans-serif;
  -webkit-overflow-scrolling:touch;
}

/* üîë Evita que WebView escale el texto autom√°ticamente */
html, body {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* üîë Asegura que los textos largos en la tarjeta no se desborden */
#tarjetaCard {
  overflow-wrap: break-word;
  word-break: break-word;
  box-sizing: border-box; /* asegura que padding y border no rompan layout */
}


/* ---------------- Intro (refinado) ---------------- */
.intro{
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  padding:2rem 2.4rem;
  background:rgba(20,24,38,.78); /* glass m√°s fino */
  border-radius:28px;
  z-index:120;
  font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  text-align:center;
  box-shadow:0 10px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
  letter-spacing:.3px;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  /* tipograf√≠a adaptable */
  font-size:clamp(1.1rem,3.8vw,1.9rem);
  font-weight:700;
  line-height:1.25;
  /* animaci√≥n de aparici√≥n suave */
  opacity:0; transform:translate(-50%,-52%) scale(.985);
  animation:introIn .6s ease-out .15s forwards, introHide 3.2s 1.7s forwards; 
}

/* texto con degradado ‚Äî cae a s√≥lido donde no hay soporte */
.intro .t{
  background:linear-gradient(120deg,#c9fff2,#30ffe4 40%,#9dd5ff);
  -webkit-background-clip:text; background-clip:text;
  -webkit-text-fill-color:transparent; color:#eaf7ff;
  text-shadow:0 0 0 transparent; /* evita halo en Safari */
}

/* subt√≠tulo m√≠nimo opcional */
.intro .s{
  display:block;
  margin-top:.45rem;
  font-weight:600;
  opacity:.85;
  font-size:clamp(.85rem,2.8vw,1.05rem);
  color:#dfe9ff;
}

/* accesibilidad: reduce movimiento */
@media (prefers-reduced-motion: reduce){
  .intro{animation:introHide 0s 2.2s forwards}
}

/* entrada */
@keyframes introIn{
  to{opacity:1; transform:translate(-50%,-50%) scale(1)}
}

/* salida */
@keyframes introHide{
  to{opacity:0; visibility:hidden; transform:translate(-50%,-80%) scale(.985)}
}


/* ---------------- Grid ---------------- */
.grid{position:absolute;inset:5vh 1.5vw;display:grid;gap:1vw}

@keyframes gridFadeIn {
  from { opacity:0; transform:translateY(12px); }
  to   { opacity:1; transform:translateY(0); }
}

@media(orientation:landscape){.grid{grid-template-columns:repeat(4,1fr)}}
@media(orientation:portrait){.grid{grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(2,1fr)}}

/* ---------------- Blocks ---------------- 
.block{position:relative;display:flex;align-items:center;justify-content:center;padding:1rem;border-radius:22px;font-weight:700;cursor:pointer;background-size:320% 320%;transition:background-position 4s,transform 0.15s ease;overflow:hidden}
// üîë feedback sutil al tocar 
.block:active {
  transform: scale(0.97);
}

.block:hover{background-position:100% 100%}
.block::before{content:"";position:absolute;inset:0;border-radius:inherit;background:linear-gradient(180deg,rgba(255,255,255,.18),transparent 65%);mix-blend-mode:overlay}
.label,.frase{z-index:2;text-align:center;color:inherit}
.frase{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:1rem;opacity:0;transition:opacity .25s}
.block.show .label{opacity:0}.block.show .frase{opacity:1}*/

/* ---------------- Blocks ---------------- */
.block{
  position:relative;
  display:flex;align-items:center;justify-content:center;
  padding:1rem;border-radius:22px;font-weight:700;cursor:pointer;
  background-size:320% 320%;
  transition:background-position 4s linear, transform .15s ease, filter .2s ease;
  overflow:hidden;isolation:isolate;
  /* depth sutil y legible sobre fondos ne√≥n */
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.06),
    0 8px 22px rgba(0,0,0,.28);
  will-change: background-position, transform;
}
.block:hover{ background-position:100% 100%; filter:saturate(1.05) contrast(1.02); }
.block:active{ transform:scale(.97); box-shadow:0 10px 24px rgba(0,0,0,.30); }
/* brillo tangencial suave que no lava el texto */
.block::before{
  content:"";position:absolute;inset:0;border-radius:inherit;
  background:linear-gradient(180deg,rgba(255,255,255,.14),transparent 62%);
  mix-blend-mode:soft-light;pointer-events:none;
}
/* anillo de contraste accesible */
.block::after{
  content:"";position:absolute;inset:0;border-radius:inherit;
  box-shadow:0 0 0 1px rgba(0,0,0,.20) inset, 0 0 0 1px rgba(255,255,255,.04);
  pointer-events:none;
}
/* respeta usuarios con reduced motion */
@media (prefers-reduced-motion: reduce){
  .block{transition:transform .15s ease}
  .block:hover{background-position:0 0;filter:none}
}


/* Labels y frases */
/* üëâ Labels y frases con animaci√≥n Jobs-like */
/* üëâ Labels y frases con animaci√≥n Jobs-like */
.label {
  z-index:2;
  text-align:center;
  opacity:1;
  transition:opacity .25s, transform .25s;
  transform:translateY(0);
  font-size:clamp(1rem, 3vw, 1.6rem); /* palabra m√°s grande */
  font-weight:700;                     /* m√°s fuerte */
  line-height:1.3;
  letter-spacing:0.3px;
}

.frase {
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:1rem;
  opacity:0;
  transform:translateY(6px); /* arranca un poco abajo */
  transition:opacity .25s, transform .25s;
  font-size:clamp(0.95rem, 2.8vw, 1.4rem); /* m√°s ligera que el label */
  font-weight:600;                          /* ahora tambi√©n negrita */
  line-height:1.35;
}

.block.show .label {
  opacity:0;
  transform:translateY(-6px); /* se va hacia arriba */
}

.block.show .frase {
  opacity:1;
  transform:translateY(0); /* sube suavemente */
}


/* ---------------- Portada ---------------- */
.portada{position:absolute;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;padding:1rem;gap:.4rem;text-align:center;animation:pop .6s ease-out forwards;max-height:90%;overflow:hidden}
@keyframes pop{0%{transform:scale(.8);opacity:0}100%{transform:scale(1);opacity:1}}
.portada img{max-width:94%;max-height:76%;border-radius:18px;box-shadow:0 12px 32px rgba(0,0,0,.55)}

.port-text h2,.port-text p,.emoji-big{animation:settle .6s ease-out forwards;opacity:0}
@keyframes settle{0%{transform:scale(1.25);opacity:0}100%{transform:scale(1);opacity:1}}
.port-text h2{font-size:clamp(2.8rem,7vw,4rem);font-weight:800;line-height:1.15;text-shadow:0 2px 6px rgba(0,0,0,.35)}
.port-text p{font-size:clamp(1.5rem,4vw,2.2rem);font-weight:600;opacity:.9;margin-top:.3rem}
.emoji-big{font-size:clamp(1.6rem,5vw,2.8rem);filter:drop-shadow(0 4px 8px rgba(0,0,0,.3))}

/* ---------------- CTA Buttons ---------------- */
.cta{
  position:fixed;bottom:3vh;left:50%;transform:translateX(-50%);
  z-index:100;display:none;gap:.9rem;justify-content:center;flex-wrap:wrap
}
.cta button{
  width:clamp(3rem,min(7vw,7vh),4rem);
  height:clamp(3rem,min(7vw,7vh),4rem);
  flex:0 0 clamp(3rem,min(7vw,7vh),4rem);
  border:none;border-radius:22px; /* pastilla m√°s moderna */
  display:flex;align-items:center;justify-content:center;
  font-size:clamp(1.25rem,3.2vw,1.7rem);
  cursor:pointer;background-size:200% 200%;
  transition:transform .2s ease, filter .2s ease, box-shadow .3s ease;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.18),
    0 8px 22px rgba(0,0,0,.28);
  backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
  outline:0; position:relative; isolation:isolate;
}
.cta button::after{
  content:"";position:absolute;inset:0;border-radius:inherit;
  box-shadow:0 0 0 1px rgba(255,255,255,.08) inset, 0 0 0 1px rgba(0,0,0,.18);
  pointer-events:none;
}
.cta button:hover{ filter:saturate(1.06) contrast(1.04); transform:translateY(-2px) }
.cta button:active{ transform:translateY(0); }
.cta button:focus-visible{ box-shadow:0 0 0 3px rgba(48,255,228,.45); }
.cta .icon{font-size:1.55rem;line-height:1;}

/* colores por defecto (si no se inyectan desde JS) */
#otro{ background:linear-gradient(135deg,#5fbfff,#1e90ff); color:#0b1820 }
#fisico{ background:linear-gradient(135deg,#b2f8c8,#42d97c); color:#0c2d1b }
#share{ background:linear-gradient(135deg,#ff8a00,#ff3d3d); color:#1b0b0b }



/* ---------------- Celebraci√≥n ---------------- */
.cele{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;align-items:center;justify-content:center;z-index:110}
.cele-msg{font-family:'Poppins';font-size:2rem;text-align:center;background:rgba(255,255,255,.05);padding:2rem 3rem;border-radius:20px}
.num{color:#30ffe4;font-weight:900;font-size:2.8rem}


#tarjetaOverlay {
  display:none;
  position:fixed;
  inset:0;
  z-index:999;
  align-items:center;
  justify-content:center;

  /* üîë Overlay profundo pero n√≠tido */
  background: radial-gradient(
    circle at center,
    rgba(0,0,0,0.85) 0%,
    rgba(0,0,0,0.92) 100%
  );

  /* ‚ùå Quitamos blur para evitar cansancio visual */
}


#tarjetaCard {
  width:360px;
  height:560px;
}


/* INICIO FIX TARJETA */
#tarjetaCard {
  width: min(420px, 90vw);
  height: 600px; /* portrait y desktop siguen igual */
  font-size: clamp(16px, 2.6vw, 22px);
  line-height: 1.35;
  -webkit-text-size-adjust: none;
  text-size-adjust: none;

  /* üîë Animaci√≥n de entrada Jobs-like */
  opacity: 0;
  transform: scale(0.92);
  animation: cardIn 0.45s ease-out forwards;
  border-radius: 20px;
}

body.webview #tarjetaCard {
  height: 650px !important; /* portrait y desktop siguen igual */
  font-size: clamp(16px, 2.4vw, 20px);
}

/* üîë Ajuste solo en landscape para que no se corte */
@media (orientation: landscape) {
  #tarjetaCard {
    height: min(560px, 85vh);
  }

  body.webview #tarjetaCard {
    height: min(650px, 85vh) !important;
  }
}
/* FIN FIX TARJETA */

@keyframes cardIn {
  from { opacity:0; transform:scale(0.92); }
  to   { opacity:1; transform:scale(1); }
}

#tarjetaCard img {
  max-width: 25%;
  max-height: 38px;
  height: auto;
  display: block;
  margin: 0 auto;
  opacity: .9;
}



body.webview {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #0e0f1b;
}
  
  
</style>
</head>
<body style="background:#0e0f1b; margin:0; padding:0; height:100%; color:#fff;">

<div class="intro" id="intro"></div>
<!-- ‚ú® Contador de libros abiertos -->
<div class="intro" id="contador" style="display:none;">
  <span class="t" id="contadorTexto">‚ú® 0 libros abiertos juntos</span>
</div>

  
<div class="grid" id="grid"></div>

<!-- CTA (aparece tras revelar) -->
<div class="cta" id="cta">
  <button id="otro">
    <span class="icon">üé≤</span>
  </button>
  <button id="share">
    <span class="icon">üìñ</span>
  </button>
  <button id="donar">
    <span class="icon">‚ù§Ô∏è</span>
  </button>
</div>


<!-- Overlay de tarjeta coleccionable -->
<div id="tarjetaOverlay">
  <div id="tarjetaCard"></div>
</div>



  
<!-- Celebraci√≥n -->
<div class="cele" id="cele"><div class="cele-msg" id="celeMsg">‚ú® <span class="num">...</span><br>libros f√≠sicos abiertos</div></div>

<script>
const grid=document.getElementById("grid"),
      cta=document.getElementById("cta"),
      btnOtro=document.getElementById("otro"),
      btnShare=document.getElementById("share"),
      btnDonar=document.getElementById("donar"),
      intro=document.getElementById("intro"),
      contador=document.getElementById("contador"),
      contadorTexto=document.getElementById("contadorTexto");


// Frases rotativas estilo Jobs
const frasesIntro = [
  "¬øQu√© sientes o qu√© buscas ahora?",
  "¬øQu√© sientes o qu√© buscas ahora?",
  "¬øQu√© sientes o qu√© buscas ahora?"
];
const introEl=document.getElementById("intro");
const frase=frasesIntro[Math.floor(Math.random()*frasesIntro.length)];
introEl.innerHTML=`<span class="t">${frase}</span>`;

  

let libro=null,revealed=false;
const portIdx=Math.floor(Math.random()*4),
      emojis=["üåä","üõ°Ô∏è","üß†","‚ú®","üìò","üîÆ","‚ù§Ô∏è","ü™û"],
            isURL = s => /^https?:\/\//i.test(s || "");
const ANG  = [115,205,35,320];
const grad = i => `linear-gradient(${ANG[i%4]}deg,${libro.colores[i]},${libro.colores[(i+1)%4]})`;


function adjustScale(wrap){
  const parent=wrap.closest(".portada");if(!parent)return;
  const avail=parent.clientHeight-40;let scale=1;wrap.style.transform="scale(1)";
  while(wrap.scrollHeight>avail&&scale>0.55){scale-=.02;wrap.style.transform=`scale(${scale})`}
}

function buildPort(i){
  const d=document.createElement("div");d.className="portada";
  const wrap=document.createElement("div");wrap.className="port-text-wrap";
  const box=document.createElement("div");box.className="port-text";
  box.innerHTML=`<h2>${libro.titulo}</h2><p>${libro.autor}</p>`;
  const emoji=document.createElement("div");emoji.className="emoji-big";emoji.textContent=emojis[i%emojis.length];
  wrap.append(box,emoji);
  if(isURL(libro.portada)){d.append(Object.assign(new Image(),{src:libro.portada,loading:"lazy"}));}
  else{d.append(wrap);setTimeout(()=>adjustScale(wrap),0);}

  // üëâ Al hacer clic en la portada: abrir tarjeta SIN recargar
  d.addEventListener("click", e => {
    e.stopPropagation(); // evita que suba al card.onclick
    btnShare.click();    // abre la tarjeta
  });

  return d;
}



function render(){
  grid.innerHTML="";
  for(let i=0;i<4;i++){
    const card=document.createElement("div");
    card.className="block";
    card.style.background=grad(i);

    const label=document.createElement("div");
    label.className="label";
    label.textContent=`${emojis[i%emojis.length]} ${libro.palabras[i]}`;
    label.style.color=libro.textColors?.[i]||"#fff";

    const frase=document.createElement("div");
    frase.className="frase";
    frase.textContent=libro.frases[i];
    frase.style.color=libro.textColors?.[i]||"#fff";

    const port=buildPort(i);

    if(i===portIdx){
      // üëâ Portada especial
      card.append(port);
      card.append(label,frase);

      card.addEventListener("click", e=>{
        if(!revealed){
          // Primera vez: revelar portada
          label.style.display="none";
          port.style.display="flex";
          [...grid.children].forEach((c,j)=>j!==portIdx&&c.classList.add("show"));
          cta.style.display="flex";
          revealed=true;
          mostrarContador();


// dentro de addEventListener("click", e=>{ ... revealed=true; ... })
const c = libro.colores;
document.getElementById("otro").style.background   =
  `linear-gradient(135deg, ${c[0]}, ${c[1]})`;
document.getElementById("share").style.background  =
  `linear-gradient(135deg, ${c[1]}, ${c[2]})`;
document.getElementById("donar").style.background  =
  `linear-gradient(135deg, ${c[2]}, ${c[3]})`;

document.getElementById("otro").style.color   = pickTextColor(c[0]);
document.getElementById("share").style.color  = pickTextColor(c[1]);
document.getElementById("donar").style.color  = pickTextColor(c[2]);

// ‚¨áÔ∏è ELIMINA por completo este bloque duplicado:
// const c=libro.colores; document.getElementById("otro").style.background = ...



// ADD: incrementa en silencio sin frenar la UI ni mostrar nada
    fetch("https://triggui-api.vercel.app/api/increment", {
      cache: "no-store"
    }).catch(()=>{});
          
        }else{
          // Clics posteriores: abrir tarjeta
          e.stopPropagation();
          btnShare.click();
        }
      });
    } else {
      // üëâ Bloques normales
      card.append(label,frase);
      card.onclick=()=>handle(card,i,port,label);
    }

    grid.append(card);
  }
}


function handle(card,i,port,label){
  if(revealed){location.reload();return;}
  if(i===portIdx){
    label.style.display="none";port.style.display="flex";
    [...grid.children].forEach((c,j)=>j!==portIdx&&c.classList.add("show"));
    cta.style.display="flex";revealed=true;
  }else{
    card.classList.toggle("show");
  }
}

//btnOtro.onclick=()=>window.open("https://triggui.com","_blank");
  btnOtro.onclick = () => {
  location.reload();
};

// ===== CONTRASTE SEGURO =====
function luminance(hex) {
  try {
    const c = hex.replace("#","").match(/.{1,2}/g).map(x=>parseInt(x,16)/255);
    const f = v => v<=.03928 ? v/12.92 : Math.pow((v+.055)/1.055,2.4);
    return 0.2126*f(c[0])+0.7152*f(c[1])+0.0722*f(c[2]);
  } catch {
    return 0; // fallback seguro
  }
}

function pickTextColor(bg) {
  try { return luminance(bg) > 0.35 ? "#000" : "#fff"; }
  catch { return "#fff"; }
}

 // ‚ú® Mostrar contador igual que el mensaje inicial
async function mostrarContador() {
  try {
    const r = await fetch("https://triggui-api.vercel.app/api/increment");
    const d = await r.json();
    const total = d.total.toLocaleString("es-MX");

    contadorTexto.innerHTML = `‚ú® ${total} libros abiertos juntos`;
    contador.style.display = "block";
    contador.style.opacity = "0";
    contador.style.transform = "translate(-50%, -52%) scale(.985)";

    // Fade-in suave (id√©ntico al intro)
    requestAnimationFrame(() => {
      contador.style.transition = "opacity .6s ease-out, transform .6s ease-out";
      contador.style.opacity = "1";
      contador.style.transform = "translate(-50%, -50%) scale(1)";
    });

    // Auto-ocultar tras 4.5 s
    setTimeout(() => {
      contador.style.transition = "opacity .8s ease-in, transform .8s ease-in";
      contador.style.opacity = "0";
      contador.style.transform = "translate(-50%, -80%) scale(.985)";
      setTimeout(() => (contador.style.display = "none"), 1000);
    }, 4500);
  } catch {
    contadorTexto.innerHTML = "üìö Error al contar libros";
    contador.style.display = "block";
  }
}
 

btnShare.onclick = () => {
  const t = libro.tarjeta;
  const card = document.getElementById("tarjetaCard");

  // Fallbacks seguros
  const safePaper  = t.style.paper  || "#111111";
  const safeInk    = t.style.ink    || pickTextColor(safePaper);
  const safeBorder = t.style.border || "#666";
  const safeSerif  = t.style.serif  || "Georgia, serif";
  const safeSans   = t.style.sans   || "Arial, sans-serif";

card.style = `
    width: min(420px, 90vw);
    height: min(600px, 90vh);
    background:${safePaper};
    color:${pickTextColor(safePaper)};
    border:2px solid ${safeBorder};
    border-radius:20px;
    padding:20px;
    font-family:${safeSerif};
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    font-size:clamp(18px, 2.2vw, 26px); /* m√°s grande en desktop */
    line-height:1.45;
    box-sizing:border-box;
    box-shadow:0 8px 32px rgba(0,0,0,.45); /* efecto depth */
  `;

  card.innerHTML = `
    <div style="font:800 22px ${safeSerif};margin-bottom:12px;letter-spacing:0.3px;">
      ${libro.titulo} ¬∑ ${libro.autor}
    </div>
    <div style="font:18px/1.45 ${safeSerif};margin-bottom:14px;opacity:.95;">
      ${t.parrafoTop}
    </div>
    <div style="font:600 21px ${safeSans};color:${t.style.accent || "#30ffe4"};margin:12px 0;">
      ${t.subtitulo}
    </div>
    <div style="font:18px/1.45 ${safeSerif};flex:1;margin-bottom:12px;">
      ${t.parrafoBot}
    </div>
    <div style="text-align:center; margin-top:10px;">
      <img src="${
        pickTextColor(safePaper) === '#000'
          ? 'https://raw.githubusercontent.com/badirnakid/triggui-app/main/public/trigguiletras2.png'
          : (
              (t.style.accent && Math.random() > 0.5)
                ? 'https://raw.githubusercontent.com/badirnakid/triggui-app/main/public/trigguiletrascolor3.png'
                : 'https://raw.githubusercontent.com/badirnakid/triggui-app/main/public/trigguiletrasblanco.png'
            )
      }"
      alt="Triggui"
      style="max-width:22%; max-height:40px; height:auto; display:block; margin:0 auto; opacity:.9;">
    </div>
  `;


  document.getElementById("tarjetaOverlay").style.display = "flex";
};

// ‚ù§Ô∏è BOT√ìN DONAR ‚Äî abre Stripe Donate universal
btnDonar.onclick = () => {
  const url = "https://donate.stripe.com/9B66oJ8bI1E02U85aR24001";
  try {
    if (window.ReactNativeWebView) {
      window.ReactNativeWebView.postMessage(
        JSON.stringify({ type: "OPEN_EXTERNAL", url })
      );
    } else {
      window.open(url, "_blank");
    }
  } catch (err) {
    console.error("Error al abrir donaci√≥n:", err);
    window.open(url, "_blank");
  }
};


 

// cerrar overlay al tocar fuera
document.getElementById("tarjetaOverlay").onclick = () =>
  document.getElementById("tarjetaOverlay").style.display = "none";



  

btnLibro.onclick=async()=>{
  btnLibro.disabled=true;cele.style.display="flex";
  celeMsg.innerHTML='‚ú® <span class="num">...</span><br>libros que hemos abierto juntos';
  try{
    const r=await fetch("https://triggui-api.vercel.app/api/increment");
    const d=await r.json();
    celeMsg.innerHTML=`‚ú® <span class="num">${d.total.toLocaleString("es-MX")}</span><br>libros que hemos abierto juntos`;
  }catch{celeMsg.textContent="üìö Error al contar libros";}
  setTimeout(()=>{cele.style.display="none";btnLibro.disabled=false},2300);
};

// üîë Detecta si est√° dentro de un WebView (Android/iOS)
function isWebView() {
  const ua = navigator.userAgent || navigator.vendor || window.opera;
  return (/wv/i.test(ua) || /WebView/i.test(ua) ||
          (ua.includes("Android") && ua.includes("Version/")) ||
          (ua.includes("iPhone") && !ua.includes("Safari")));
}
if (isWebView()) {
  document.body.classList.add("webview");
}

  
(async()=>{
  try{
    const r=await fetch("https://raw.githubusercontent.com/badirnakid/triggui-content/main/contenido.json?ts="+Date.now());
    const data=await r.json();
    libro=data.libros[Math.floor(Math.random()*data.libros.length)];
    render();
  }catch(e){alert("No se pudo cargar Triggui.");console.error(e);}
})();
</script>

  
<script>
  // Enviamos FIRST_PAINT lo antes posible: DOM listo + 1 frame real
  const signalFirstPaint = () => {
    requestAnimationFrame(() => {
      try {
        window.ReactNativeWebView?.postMessage("FIRST_PAINT");
      } catch (_) {
        // silencioso: si no hay RN WebView, no rompe web
      }
    });
  };

  if (document.readyState === "interactive" || document.readyState === "complete") {
    // Si el DOM ya est√° listo cuando se inyecta este script
    signalFirstPaint();
  } else {
    // Si a√∫n no, esperamos a DOMContentLoaded
    document.addEventListener("DOMContentLoaded", signalFirstPaint, { once: true });
  }
</script>

</body>
</html>
